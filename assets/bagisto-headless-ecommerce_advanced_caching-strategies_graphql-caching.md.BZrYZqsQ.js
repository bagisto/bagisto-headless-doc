import{j as a,c as s,b as i,ah as t}from"./chunks/framework.Br27zpCu.js";const g=JSON.parse('{"title":"GraphQL Caching","description":"","frontmatter":{},"headers":[],"relativePath":"bagisto-headless-ecommerce/advanced/caching-strategies/graphql-caching.md","filePath":"bagisto-headless-ecommerce/advanced/caching-strategies/graphql-caching.md","lastUpdated":1769093839000}'),n={name:"bagisto-headless-ecommerce/advanced/caching-strategies/graphql-caching.md"};function r(l,e,h,o,c,p){return i(),s("div",null,[...e[0]||(e[0]=[t(`<h1 id="graphql-caching" tabindex="-1">GraphQL Caching <a class="header-anchor" href="#graphql-caching" aria-label="Permalink to &quot;GraphQL Caching&quot;">‚Äã</a></h1><p>This guide explains how GraphQL-specific caching is implemented and managed in the Bagisto Headless storefront, both on the server and the client.</p><h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to &quot;Overview&quot;">‚Äã</a></h2><p>In Bagisto Headless, we use <strong>Apollo Client</strong> as the primary engine for interacting with the Bagisto GraphQL API. Caching is used to minimize network traffic and provide a snappy user interface by reusing previously fetched data.</p><h2 id="_1-client-side-caching-normalized-cache" tabindex="-1">1. Client-Side Caching (Normalized Cache) <a class="header-anchor" href="#_1-client-side-caching-normalized-cache" aria-label="Permalink to &quot;1. Client-Side Caching (Normalized Cache)&quot;">‚Äã</a></h2><p>Apollo Client features a sophisticated <strong>Normalized Cache</strong> (<code>InMemoryCache</code>) that stores the results of your GraphQL queries in a flattened format.</p><p><strong>File:</strong> <code>src/lib/apollo-client.ts</code></p><h3 id="configuration" tabindex="-1">Configuration <a class="header-anchor" href="#configuration" aria-label="Permalink to &quot;Configuration&quot;">‚Äã</a></h3><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> cache</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> InMemoryCache</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ApolloClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  cache: cache,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  defaultOptions: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    watchQuery: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      fetchPolicy: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;cache-first&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    query: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      fetchPolicy: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;cache-first&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><h3 id="fetch-policies" tabindex="-1">Fetch Policies <a class="header-anchor" href="#fetch-policies" aria-label="Permalink to &quot;Fetch Policies&quot;">‚Äã</a></h3><p>We utilize different fetch policies depending on the environment:</p><ul><li><strong><code>cache-first</code> (Default Client):</strong> Checks the cache first. If data is found, it returns it instantly; otherwise, it executes a network request.</li><li><strong><code>network-only</code> (Default Server/SSR):</strong> Always bypasses the cache to ensure the server-side rendered HTML is fresh.</li><li><strong><code>no-cache</code>:</strong> Used for mutations or sensitive data that should never be stored.</li></ul><h2 id="_2-server-side-data-fetching-graphqlrequest" tabindex="-1">2. Server-Side Data Fetching (<code>graphqlRequest</code>) <a class="header-anchor" href="#_2-server-side-data-fetching-graphqlrequest" aria-label="Permalink to &quot;2. Server-Side Data Fetching (\`graphqlRequest\`)&quot;">‚Äã</a></h2><p>For Server Components, we have a custom wrapper that combines Apollo Client&#39;s query execution with Next.js&#39;s native caching.</p><p><strong>File:</strong> <code>src/lib/graphql-fetch.ts</code></p><p>While Next.js handles the persistence (File/Redis), the <code>graphqlRequest</code> utility manages the <strong>Apollo <code>fetchPolicy</code></strong> during the fetch operation:</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (options?.noCache) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> result</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    query,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    variables,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    fetchPolicy: options?.fetchPolicy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">??</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;no-cache&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> result.data;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="_3-fragment-based-caching" tabindex="-1">3. Fragment-Based Caching <a class="header-anchor" href="#_3-fragment-based-caching" aria-label="Permalink to &quot;3. Fragment-Based Caching&quot;">‚Äã</a></h2><p>By using <strong>GraphQL Fragments</strong>, we ensure that different queries return standardized objects (e.g., <code>Product</code> or <code>Cart</code>). Apollo&#39;s normalized cache uses these standard IDs (like <code>Product:123</code>) to automatically update all components that use that same data when it changes.</p><h2 id="_4-cache-invalidation-patterns" tabindex="-1">4. Cache Invalidation Patterns <a class="header-anchor" href="#_4-cache-invalidation-patterns" aria-label="Permalink to &quot;4. Cache Invalidation Patterns&quot;">‚Äã</a></h2><h3 id="client-side" tabindex="-1">Client-Side <a class="header-anchor" href="#client-side" aria-label="Permalink to &quot;Client-Side&quot;">‚Äã</a></h3><ul><li><strong><code>refetchQueries</code>:</strong> After a mutation (like adding an item to the cart), we often tell Apollo to refetch related queries to ensure the UI is in sync.</li><li><strong>Direct Cache Updates:</strong> For faster UI feedback, we can manually update the Apollo cache after a successful mutation.</li></ul><h3 id="server-side" tabindex="-1">Server-Side <a class="header-anchor" href="#server-side" aria-label="Permalink to &quot;Server-Side&quot;">‚Äã</a></h3><ul><li><strong>Revalidation Tags:</strong> We assign custom tags to our server-side cached requests. When a product is updated in Bagisto, a webhook (or manual revalidation) can trigger a purge of all requests tagged with <code>products</code>.</li></ul><h2 id="summary" tabindex="-1">Summary <a class="header-anchor" href="#summary" aria-label="Permalink to &quot;Summary&quot;">‚Äã</a></h2><ul><li><strong>Normalization:</strong> Apollo Client stores data as a flat lookup table based on IDs.</li><li><strong>Policy Driven:</strong> Different behaviors for SSR (freshness) vs Client (speed).</li><li><strong>Synergy:</strong> Works alongside Next.js caching to provide a comprehensive optimization layer.</li></ul><h2 id="next-steps" tabindex="-1">Next Steps <a class="header-anchor" href="#next-steps" aria-label="Permalink to &quot;Next Steps&quot;">‚Äã</a></h2><ul><li>‚ö° <a href="/bagisto-headless-ecommerce/advanced/caching-strategies/nextjs-caching">Next.js Caching</a> - How these queries are persisted on the server.</li><li>üèóÔ∏è <a href="/bagisto-headless-ecommerce/overview/architecture-overview">Architecture Overview</a> - The global data flow.</li><li>üß± <a href="/bagisto-headless-ecommerce/graphql-schema/graphql-operations/fragments">GraphQL Fragments</a> - The foundation of normalized caching.</li></ul>`,28)])])}const k=a(n,[["render",r]]);export{g as __pageData,k as default};
