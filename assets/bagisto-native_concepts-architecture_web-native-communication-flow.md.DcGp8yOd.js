import{j as h,E as o,c as r,b as t,q as i,h as k,ah as a,f as s,w as l,I as d,ai as p}from"./chunks/framework.Br27zpCu.js";const v=JSON.parse('{"title":"Web ‚Üî Native Communication Flow üîÅ","description":"","frontmatter":{},"headers":[],"relativePath":"bagisto-native/concepts-architecture/web-native-communication-flow.md","filePath":"bagisto-native/concepts-architecture/web-native-communication-flow.md","lastUpdated":1769093839000}'),c={name:"bagisto-native/concepts-architecture/web-native-communication-flow.md"};function g(E,e,u,y,b,F){const n=o("Mermaid");return t(),r("div",null,[e[1]||(e[1]=i("h1",{id:"web-‚Üî-native-communication-flow-üîÅ",tabindex:"-1"},[s("Web ‚Üî Native Communication Flow üîÅ "),i("a",{class:"header-anchor",href:"#web-‚Üî-native-communication-flow-üîÅ","aria-label":'Permalink to "Web ‚Üî Native Communication Flow üîÅ"'},"‚Äã")],-1)),e[2]||(e[2]=i("p",null,[i("strong",null,"Summary:"),s(" This document explains how Bagisto Native uses an event-driven bridge (Hotwire + Stimulus + native bridge) to enable safe, decoupled two-way communication between a web app and a native mobile app. It includes diagrams, code examples, event names, and a quick integration checklist.")],-1)),e[3]||(e[3]=i("hr",null,null,-1)),e[4]||(e[4]=i("h2",{id:"architecture-high-level-üèóÔ∏è",tabindex:"-1"},[s("Architecture (high level) üèóÔ∏è "),i("a",{class:"header-anchor",href:"#architecture-high-level-üèóÔ∏è","aria-label":'Permalink to "Architecture (high level) üèóÔ∏è"'},"‚Äã")],-1)),e[5]||(e[5]=i("p",null,"Mermaid diagram (copyable; render with a mermaid-supported viewer):",-1)),(t(),k(p,null,{default:l(()=>[d(n,{id:"mermaid-13",class:"mermaid",graph:"flowchart%20LR%0A%20%20subgraph%20Web_App%5BWeb%20App%5D%0A%20%20%20%20A%5BHidden%20Web%20Components%3Cbr%2F%3E(%3Chotwire-*%3E%2C%20data-controller)%5D%0A%20%20%20%20B%5BUtilities%20(triggerHotwireNativeToast%2C%20...)%5D%0A%20%20%20%20C%5Bwindow%20event%20listeners%5D%0A%20%20end%0A%0A%20%20subgraph%20Hotwire_Bridge%5BHotwire%20Bridge%5D%0A%20%20%20%20D%5BStimulus%20controllers%20%2B%20Bridge%5D%0A%20%20end%0A%0A%20%20subgraph%20Native_App%5BNative%20App%5D%0A%20%20%20%20E%5BBridge%20Components%20(toast%2C%20dynamicbutton%2C%20location...)%5D%0A%20%20%20%20F%5BNative%20UI%20%2F%20Actions%5D%0A%20%20end%0A%0A%20%20B%20--%3E%20A%0A%20%20A%20--%3E%20D%0A%20%20D%20--%3E%20E%0A%20%20E%20--%3E%20F%0A%20%20F%20--%3E%20D%0A%20%20D%20--%3E%20A%0A%20%20A%20--%3E%20C%0A"})]),fallback:l(()=>[...e[0]||(e[0]=[s(" Loading... ",-1)])]),_:1})),e[6]||(e[6]=a(`<p>Fallback ASCII diagram:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Web App (React/Next)    &lt;---- Hotwire Bridge ----&gt;   Native App (iOS / Android)</span></span>
<span class="line"><span>[Hidden &lt;hotwire-*&gt;]  -- data-* attrs / clicks --&gt;  [BridgeComponent.send(...)]</span></span>
<span class="line"><span>[window events]  &lt;-- CustomEvent responses / callbacks --  [native sends events]</span></span></code></pre></div><hr><h2 id="components-involved-üîß" tabindex="-1">Components Involved üîß <a class="header-anchor" href="#components-involved-üîß" aria-label="Permalink to &quot;Components Involved üîß&quot;">‚Äã</a></h2><ul><li><strong>@bagisto-native/core</strong><ul><li>Web Components (e.g., <code>&lt;hotwire-toast&gt;</code>, <code>&lt;dynamic-button&gt;</code>, <code>&lt;hotwire-location&gt;</code>)</li><li>Stimulus controllers in <code>core/hotwire/controllers/</code></li><li>Utilities in <code>core/src/utils/utils.ts</code></li></ul></li><li><strong>@bagisto-native/react</strong><ul><li>Thin React wrappers that render the hidden web components</li></ul></li><li><strong>Native side</strong><ul><li>Bridge components implemented using <code>@hotwired/hotwire-native-bridge</code></li></ul></li></ul><blockquote><p><strong>Note:</strong> The <code>bundle.js</code> file from <code>@bagisto-native/core/public/hotwire</code> must be included in your app‚Äôs <code>public/</code> folder and loaded on pages that use native features.</p></blockquote><hr><h2 id="message-flow-‚Äî-web-‚Üí-native-‚û°Ô∏è" tabindex="-1">Message Flow ‚Äî Web ‚Üí Native ‚û°Ô∏è <a class="header-anchor" href="#message-flow-‚Äî-web-‚Üí-native-‚û°Ô∏è" aria-label="Permalink to &quot;Message Flow ‚Äî Web ‚Üí Native ‚û°Ô∏è&quot;">‚Äã</a></h2><ol><li>Web code calls a utility or sets a <code>data-bridge-*</code> attribute on a hidden web component.</li><li>The utility locates the element wired to a Stimulus controller, sets attributes (e.g., <code>data-bridge-message</code>) and triggers a <code>.click()</code> (or dispatches an event).</li><li>The Stimulus controller picks this up and calls <code>this.send(...)</code> through the Hotwire native bridge.</li><li>The native Bridge Component receives the message and performs the native action (toast, open cart, scan, etc.).</li></ol><p>Example (utility usage):</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { triggerHotwireNativeToast } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;@bagisto-native/core&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">triggerHotwireNativeToast</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Profile updated!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><p>Under the hood:</p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>document.querySelector(&quot;[data-controller=&#39;bridge--toast&#39;]&quot;)</span></span>
<span class="line"><span>  .setAttribute(&#39;data-bridge-message&#39;, message);</span></span>
<span class="line"><span>document.querySelector(...).click();</span></span>
<span class="line"><span>// Stimulus controller handles click -&gt; this.send(&quot;show&quot;, {message})</span></span></code></pre></div><hr><h2 id="message-flow-‚Äî-native-‚Üí-web-‚¨ÖÔ∏è" tabindex="-1">Message Flow ‚Äî Native ‚Üí Web ‚¨ÖÔ∏è <a class="header-anchor" href="#message-flow-‚Äî-native-‚Üí-web-‚¨ÖÔ∏è" aria-label="Permalink to &quot;Message Flow ‚Äî Native ‚Üí Web ‚¨ÖÔ∏è&quot;">‚Äã</a></h2><ol><li>A native action occurs (user scanned a barcode, tapped share, etc.).</li><li>The native Bridge Component sends data back or triggers a web-visible response.</li><li>The web app receives a <code>CustomEvent</code> (e.g., <code>turbo:next-search</code>) or the Stimulus controller dispatches an event that the app listens for.</li></ol><p>Common events emitted to web:</p><ul><li><code>turbo:next-search</code> ‚Üí { query?, code? } (search / scan results)</li><li><code>turbo:next-cart-modal</code> ‚Üí (open cart modal)</li><li><code>turbo:hotwire-app-fill-addresses</code> ‚Üí { data } (location reverse-geocode results)</li><li><code>turbo:next-history-sync</code> ‚Üí { URL } (history sync)</li></ul><p>Example (listening to native search):</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">window.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addEventListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;turbo:next-search&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">e</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> customEvent</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> e </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CustomEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;{ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">query</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">code</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }&gt;;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> query</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> customEvent.detail.query </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> customEvent.detail.code;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // handle the query (router push / filter)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><hr><h2 id="sequence-example-‚Äî-history-sync-üîÅ" tabindex="-1">Sequence Example ‚Äî History Sync üîÅ <a class="header-anchor" href="#sequence-example-‚Äî-history-sync-üîÅ" aria-label="Permalink to &quot;Sequence Example ‚Äî History Sync üîÅ&quot;">‚Äã</a></h2><ol><li>Web detects a route change (e.g., Next.js <code>usePathname</code>).</li><li>Web calls:</li></ol><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">triggerHistorySyncEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> URL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(window.location.href));</span></span></code></pre></div><ol start="3"><li>Utility finds the <code>bridge--historysync</code> element and dispatches <code>turbo:next-history-sync</code> with detail <code>{ url }</code>.</li><li>The Stimulus controller <code>bridge--historysync</code> handles the event and calls <code>this.send(&quot;history&quot;, { location: url.toString() })</code> to the native layer.</li></ol><hr><h2 id="events-utilities-reference-quick-‚ö°" tabindex="-1">Events &amp; Utilities Reference (quick) ‚ö° <a class="header-anchor" href="#events-utilities-reference-quick-‚ö°" aria-label="Permalink to &quot;Events &amp; Utilities Reference (quick) ‚ö°&quot;">‚Äã</a></h2><p><strong>Utilities (from <code>@bagisto-native/core</code>):</strong></p><ul><li><code>isTurboNativeUserAgent(userAgent?: string): boolean</code></li><li><code>triggerHotwireNativeToast(message: string): void</code></li><li><code>triggerHistorySyncEvent(url: URL): void</code></li><li><code>triggerThemeModeEvent(mode: &#39;light&#39; | &#39;dark&#39;): void</code></li><li><code>triggerCartCountValue(cartcount: number): void</code></li></ul><p><strong>Events to watch for:</strong></p><ul><li><code>turbo:next-search</code> ‚Äî native ‚Üí web (search)</li><li><code>turbo:next-cart-modal</code> ‚Äî native ‚Üí web (open cart)</li><li><code>turbo:hotwire-app-fill-addresses</code> ‚Äî native ‚Üí web (location)</li><li><code>turbo:next-history-sync</code> ‚Äî web ‚Üî native (history sync)</li></ul><hr><h2 id="quick-copyable-snippets-‚úÖ" tabindex="-1">Quick copyable snippets ‚úÖ <a class="header-anchor" href="#quick-copyable-snippets-‚úÖ" aria-label="Permalink to &quot;Quick copyable snippets ‚úÖ&quot;">‚Äã</a></h2><p>Minimal toast trigger:</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { triggerHotwireNativeToast } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;@bagisto-native/core&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">triggerHotwireNativeToast</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Saved!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><p>History sync (Next.js):</p>`,36)),e[7]||(e[7]=i("div",null,[i("div",{class:"language-ts vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"ts"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0","v-pre":""},[i("code",null,[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," { useEffect } "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"from"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "react"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," { usePathname, useSearchParams } "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"from"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "next/navigation"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," { triggerHistorySyncEvent } "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"from"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "@bagisto-native/core"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"export"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," default"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," function"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," HistorySync"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"  const"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," pathname"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," usePathname"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"  const"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," searchParams"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," useSearchParams"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"  useEffect"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(() "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=>"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    const"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," origin"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," window.location.origin;")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    const"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," search"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," searchParams."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"toString"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "?"'),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," +"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," searchParams."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"toString"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},":"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' ""'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    const"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," url"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," URL"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(origin "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," pathname "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," search);")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    triggerHistorySyncEvent"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(url);")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  }, [pathname, searchParams]);")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"  return"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])])])],-1)),e[8]||(e[8]=i("p",null,"Listen to native search event:",-1)),e[9]||(e[9]=i("div",null,[i("div",{class:"language-ts vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"ts"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0","v-pre":""},[i("code",null,[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"useEffect"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(() "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=>"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"  const"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," handleTurboSearch"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"e"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},":"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Event"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=>"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    const"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," customEvent"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," e "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"as"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," CustomEvent"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"<{ "),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"query"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?:"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," string"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"; "),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"code"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?:"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," string"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," }>;")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    const"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," query"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," customEvent.detail.query "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"||"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," customEvent.detail.code;")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    if"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"query) "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"return"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    router."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"push"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"/search?q="'),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," +"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," encodeURIComponent"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(query));")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  };")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  window."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"addEventListener"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"turbo:next-search"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", handleTurboSearch);")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"  return"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," () "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=>"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," window."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"removeEventListener"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"turbo:next-search"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", handleTurboSearch);")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}, [router]);")])])])])],-1)),e[10]||(e[10]=a('<hr><h2 id="integration-checklist-‚úÖ" tabindex="-1">Integration Checklist ‚úÖ <a class="header-anchor" href="#integration-checklist-‚úÖ" aria-label="Permalink to &quot;Integration Checklist ‚úÖ&quot;">‚Äã</a></h2><ul><li>[ ] Install packages:</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @bagisto-native/core</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @bagisto-native/react</span></span></code></pre></div><ul><li>[ ] Copy <code>node_modules/@bagisto-native/core/public/hotwire/bundle.js</code> ‚Üí <code>public/hotwire/bundle.js</code> and include it on all pages.</li><li>[ ] Render React wrapper components at the app root (hidden): e.g., <code>&lt;HotwireToast /&gt;</code>, <code>&lt;HotwireHistorySync /&gt;</code>, <code>&lt;DynamicButton /&gt;</code>.</li><li>[ ] Add <code>window</code> event listeners for: <ul><li><code>turbo:next-search</code></li><li><code>turbo:next-cart-modal</code></li><li><code>turbo:hotwire-app-fill-addresses</code></li><li><code>turbo:next-history-sync</code></li></ul></li><li>[ ] Use utilities to trigger native interactions from app logic.</li><li>[ ] Use <code>isTurboNativeUserAgent()</code> where behavior should be gated to native contexts.</li></ul><hr><h2 id="best-practices-troubleshooting-üß≠" tabindex="-1">Best Practices &amp; Troubleshooting üß≠ <a class="header-anchor" href="#best-practices-troubleshooting-üß≠" aria-label="Permalink to &quot;Best Practices &amp; Troubleshooting üß≠&quot;">‚Äã</a></h2><ul><li>Keep bridge elements hidden (e.g., <code>style=&amp;#123;&amp;#123; display: &#39;none&#39; &amp;#125;&amp;#125;</code>) ‚Äî they are anchors only.</li><li>Utilities are SSR-safe (they check <code>document</code> first). Use them in client-only code.</li><li>Ensure <code>bundle.js</code> is included; missing bundle is the most common cause of communication failures.</li><li>Add console logs inside Stimulus controllers (or on native side) when diagnosing event flows.</li><li>If events don‚Äôt appear in the web, confirm the native Bridge Component is sending data and the web&#39;s <code>window</code> listener is attached.</li></ul><blockquote><p>Tip: For debugging, temporarily show the web components (remove <code>display:none</code>) and add <code>console.log</code> inside event handlers to observe attribute changes and dispatched events.</p></blockquote><hr><p><strong>Done.</strong> This file documents the Web ‚Üî Native communication flow with diagrams, code examples, and an integration checklist.</p><h2 id="next-steps" tabindex="-1">Next Steps <a class="header-anchor" href="#next-steps" aria-label="Permalink to &quot;Next Steps&quot;">‚Äã</a></h2><ul><li>Learn about <a href="./roles-of-components">Roles of Components</a></li><li>Explore <a href="./hotwire-turbo-native">Hotwire &amp; Turbo Native</a></li><li>Understand <a href="./why-webview-native-bridge">Why WebView + Native Bridge</a></li></ul>',13))])}const C=h(c,[["render",g]]);export{v as __pageData,C as default};
