import{j as e,c as i,b as a,ah as t}from"./chunks/framework.Br27zpCu.js";const k=JSON.parse('{"title":"Multi-step Checkout","description":"","frontmatter":{},"headers":[],"relativePath":"bagisto-headless-ecommerce/features/checkout/checkout-flow/multi-step-checkout.md","filePath":"bagisto-headless-ecommerce/features/checkout/checkout-flow/multi-step-checkout.md","lastUpdated":1768400907000}'),n={name:"bagisto-headless-ecommerce/features/checkout/checkout-flow/multi-step-checkout.md"};function h(l,s,p,r,o,d){return a(),i("div",null,[...s[0]||(s[0]=[t(`<h1 id="multi-step-checkout" tabindex="-1">Multi-step Checkout <a class="header-anchor" href="#multi-step-checkout" aria-label="Permalink to &quot;Multi-step Checkout&quot;">‚Äã</a></h1><p>This guide explains the implementation of the multi-step checkout process in the Bagisto Headless storefront.</p><h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to &quot;Overview&quot;">‚Äã</a></h2><p>The checkout process is broken down into five distinct steps to ensure a smooth user experience. Each step captures specific information required to place an order, starting from the user&#39;s email to a final order review. The state is managed via URL search parameters and Redux, ensuring that the current progress is maintained across page refreshes.</p><h2 id="_1-checkout-steps" tabindex="-1">1. Checkout Steps <a class="header-anchor" href="#_1-checkout-steps" aria-label="Permalink to &quot;1. Checkout Steps&quot;">‚Äã</a></h2><p>The checkout process follows the sequence: <strong>Email</strong> ‚Üí <strong>Address</strong> ‚Üí <strong>Shipping</strong> ‚Üí <strong>Payment</strong> ‚Üí <strong>Review</strong>.</p><h3 id="logic-overview" tabindex="-1">Logic Overview <a class="header-anchor" href="#logic-overview" aria-label="Permalink to &quot;Logic Overview&quot;">‚Äã</a></h3><p>The current step is determined by the <code>step</code> search parameter in the URL. If no parameter is provided, it defaults to the <code>email</code> step.</p><p><strong>File:</strong> <code>src/app/(checkout)/checkout/page.tsx</code></p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">step</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;email&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> searchParams);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">CheckOut</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> step</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">={</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">step</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} /&gt;;</span></span></code></pre></div><p>The <code>Stepper</code> component then renders the appropriate step based on this key.</p><p><strong>Step Keys:</strong></p><ul><li><code>email</code>: User identification (guest or customer).</li><li><code>address</code>: Collection of billing and shipping addresses.</li><li><code>shipping</code>: Selection of available shipping methods.</li><li><code>payment</code>: Selection of available payment methods.</li><li><code>review</code>: Order summary and final placement.</li></ul><h2 id="_2-graphql-operations" tabindex="-1">2. GraphQL Operations <a class="header-anchor" href="#_2-graphql-operations" aria-label="Permalink to &quot;2. GraphQL Operations&quot;">‚Äã</a></h2><p>Each step involves specific GraphQL mutations to save information incrementally to the Bagisto backend.</p><h3 id="billing-shipping-address" tabindex="-1">Billing &amp; Shipping Address <a class="header-anchor" href="#billing-shipping-address" aria-label="Permalink to &quot;Billing &amp; Shipping Address&quot;">‚Äã</a></h3><p>Saves the customer&#39;s contact and physical address information.</p><p><strong>Mutation:</strong> <code>CREATE_CHECKOUT_ADDRESS</code><strong>File:</strong> <code>src/graphql/checkout/mutations/CreateCheckoutAddress.ts</code></p><div class="language-graphql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">graphql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">mutation</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createCheckoutAddress</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">$token</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">$billingFirstName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ...) {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  createCheckoutAddress</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">input</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    token</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">$token</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    billingFirstName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">$billingFirstName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ... other billing/shipping fields</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }) {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    checkoutAddress</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">      success</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">      message</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="shipping-payment-methods" tabindex="-1">Shipping &amp; Payment Methods <a class="header-anchor" href="#shipping-payment-methods" aria-label="Permalink to &quot;Shipping &amp; Payment Methods&quot;">‚Äã</a></h3><p>After addresses are saved, the backend calculates available shipping and payment options. These are saved using:</p><ul><li><code>CREATE_CHECKOUT_SHIPPING_METHOD</code></li><li><code>CREATE_CHECKOUT_PAYMENT_METHOD</code></li></ul><h3 id="final-order-placement" tabindex="-1">Final Order Placement <a class="header-anchor" href="#final-order-placement" aria-label="Permalink to &quot;Final Order Placement&quot;">‚Äã</a></h3><p>The final step executes the order creation.</p><p><strong>Mutation:</strong> <code>CREATE_CHECKOUT_ORDER</code><strong>File:</strong> <code>src/graphql/checkout/mutations/CreateCheckoutOrder.ts</code></p><h2 id="_3-frontend-implementation" tabindex="-1">3. Frontend Implementation <a class="header-anchor" href="#_3-frontend-implementation" aria-label="Permalink to &quot;3. Frontend Implementation&quot;">‚Äã</a></h2><h3 id="the-stepper-component" tabindex="-1">The Stepper Component <a class="header-anchor" href="#the-stepper-component" aria-label="Permalink to &quot;The Stepper Component&quot;">‚Äã</a></h3><p>The <code>Stepper</code> component acts as a layout wrapper for all checkout steps, providing a visual progress indicator.</p><p><strong>File:</strong> <code>src/components/checkout/stepper/index.tsx</code></p><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> steps</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  { id: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, key: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;email&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, title: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Email&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, component: &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Email</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /&gt; },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  { id: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, key: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;address&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, title: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Address&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, component: &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">GuestAddAdressForm</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /&gt; },</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ... other steps</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">];</span></span></code></pre></div><h3 id="state-navigation" tabindex="-1">State &amp; Navigation <a class="header-anchor" href="#state-navigation" aria-label="Permalink to &quot;State &amp; Navigation&quot;">‚Äã</a></h3><p>The storefront uses <strong>Redux</strong> to share cart details across the checkout steps and <strong>URL routing</strong> to navigate between them. When a step is successfully completed (e.g., after the <code>CREATE_CHECKOUT_ADDRESS</code> mutation), the user is redirected to the next step via:</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">router.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/checkout?step=shipping&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><h2 id="_4-caching-performance" tabindex="-1">4. Caching &amp; Performance <a class="header-anchor" href="#_4-caching-performance" aria-label="Permalink to &quot;4. Caching &amp; Performance&quot;">‚Äã</a></h2><p>Checkout operations are inherently dynamic and transaction-based. To ensure data accuracy:</p><ul><li><strong>No Caching:</strong> All checkout API requests are made with <code>cache: &quot;no-store&quot;</code> to prevent stale data.</li><li><strong>Server Actions:</strong> Mutations are triggered by client interactions, providing immediate feedback.</li><li><strong>Revalidation:</strong> After placing an order, the cart state is cleared in Redux.</li></ul><h2 id="summary" tabindex="-1">Summary <a class="header-anchor" href="#summary" aria-label="Permalink to &quot;Summary&quot;">‚Äã</a></h2><ul><li><strong>Incremental Progress:</strong> Information is saved step-by-step to the backend.</li><li><strong>URL-Based Routing:</strong> The progress is tracked and navigated via the <code>step</code> search parameter.</li><li><strong>Redux Integration:</strong> Global cart state is utilized to display totals, items, and selected methods throughout the flow.</li><li><strong>Transaction Integrity:</strong> No-cache policies ensure the checkout data always reflects the latest backend calculations.</li></ul><h2 id="next-steps" tabindex="-1">Next Steps <a class="header-anchor" href="#next-steps" aria-label="Permalink to &quot;Next Steps&quot;">‚Äã</a></h2><ul><li>üí≥ <a href="/bagisto-headless-ecommerce/features/checkout/payment-integration/payment-methods">Payment Integration</a> - Deep dive into payment provider setup.</li><li>üì¶ <a href="/bagisto-headless-ecommerce/features/checkout/shipping-billing/address-management">Shipping &amp; Billing</a> - Details on address management.</li><li>üõçÔ∏è <a href="/bagisto-headless-ecommerce/features/cart/cart-operations/clear-cart">Clear Cart</a> - How the session is reset after a successful order.</li></ul>`,40)])])}const g=e(n,[["render",h]]);export{k as __pageData,g as default};
