import{j as n,E as h,c as r,b as a,q as s,h as o,ah as d,f as e,w as i,I as p,ai as c}from"./chunks/framework.Br27zpCu.js";const b=JSON.parse('{"title":"Cache Options & Configuration","description":"","frontmatter":{},"headers":[],"relativePath":"bagisto-headless-ecommerce/apollo-client/cache-options.md","filePath":"bagisto-headless-ecommerce/apollo-client/cache-options.md","lastUpdated":1768234161000}'),k={name:"bagisto-headless-ecommerce/apollo-client/cache-options.md"};function g(E,t,y,u,f,x){const l=h("Mermaid");return a(),r("div",null,[t[1]||(t[1]=s("h1",{id:"cache-options-configuration",tabindex:"-1"},[e("Cache Options & Configuration "),s("a",{class:"header-anchor",href:"#cache-options-configuration","aria-label":'Permalink to "Cache Options & Configuration"'},"â€‹")],-1)),t[2]||(t[2]=s("p",null,"High-performance e-commerce requires a sophisticated caching strategy. Bagisto Headless utilizes a multi-layered approach to balance lightning-fast loads with data integrity.",-1)),t[3]||(t[3]=s("h2",{id:"_1-multi-layered-architecture",tabindex:"-1"},[e("1. Multi-Layered Architecture "),s("a",{class:"header-anchor",href:"#_1-multi-layered-architecture","aria-label":'Permalink to "1. Multi-Layered Architecture"'},"â€‹")],-1)),(a(),o(c,null,{default:i(()=>[p(l,{id:"mermaid-9",class:"mermaid",graph:"graph%20TD%0A%20%20%20%20Browser(%5B%22Browser%20Cache%20(HTTP%20Headers)%22%5D)%20--%3E%20Apollo%5B%22Apollo%20Client%20(InMemory%20Cache)%22%5D%0A%20%20%20%20Apollo%20--%3E%20NextServer%5B%22Next.js%20Server%20(Data%20Cache)%22%5D%0A%20%20%20%20NextServer%20--%3E%20Bagisto%5B%22Bagisto%20Backend%20(GraphQL%20API)%22%5D%0A%0A%20%20%20%20subgraph%20%22Frontend%20Layer%22%0A%20%20%20%20%20%20%20%20Browser%0A%20%20%20%20%20%20%20%20Apollo%0A%20%20%20%20end%0A%0A%20%20%20%20subgraph%20%22Server%20Layer%22%0A%20%20%20%20%20%20%20%20NextServer%0A%20%20%20%20end%0A"})]),fallback:i(()=>[...t[0]||(t[0]=[e(" Loading... ",-1)])]),_:1})),t[4]||(t[4]=d(`<table tabindex="0"><thead><tr><th style="text-align:left;">Layer</th><th style="text-align:left;">Technology</th><th style="text-align:left;">Primary Purpose</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>HTTP Headers</strong></td><td style="text-align:left;">Browser/CDN</td><td style="text-align:left;">Static asset &amp; full-page caching.</td></tr><tr><td style="text-align:left;"><strong>Apollo Cache</strong></td><td style="text-align:left;">Apollo Client</td><td style="text-align:left;">Client-side normalized data storage.</td></tr><tr><td style="text-align:left;"><strong>Data Cache</strong></td><td style="text-align:left;">Next.js <code>unstable_cache</code></td><td style="text-align:left;">Server-side GraphQL query persistence.</td></tr></tbody></table><h2 id="_2-apollo-client-fetch-policies" tabindex="-1">2. Apollo Client Fetch Policies <a class="header-anchor" href="#_2-apollo-client-fetch-policies" aria-label="Permalink to &quot;2. Apollo Client Fetch Policies&quot;">â€‹</a></h2><p>These policies control how components interact with the client-side cache.</p><table tabindex="0"><thead><tr><th style="text-align:left;">Policy</th><th style="text-align:left;">Behavior</th><th style="text-align:left;">Best Use Case</th></tr></thead><tbody><tr><td style="text-align:left;"><strong><code>cache-first</code></strong></td><td style="text-align:left;">Check cache, then network.</td><td style="text-align:left;">Static content, categories.</td></tr><tr><td style="text-align:left;"><strong><code>network-only</code></strong></td><td style="text-align:left;">Always fetch from API.</td><td style="text-align:left;">Real-time data, SSR.</td></tr><tr><td style="text-align:left;"><strong><code>cache-and-network</code></strong></td><td style="text-align:left;">Show cache immediately, update in background.</td><td style="text-align:left;">Product details, search results.</td></tr><tr><td style="text-align:left;"><strong><code>no-cache</code></strong></td><td style="text-align:left;">Never read or write to cache.</td><td style="text-align:left;">Sensitive/Transactional data.</td></tr></tbody></table><div class="tip custom-block github-alert"><p class="custom-block-title">TIP</p><p>Use <code>cache-and-network</code> for a &quot;perceived&quot; instant load while ensuring the user eventually sees the most up-to-date metadata.</p></div><h2 id="_3-next-js-server-side-caching" tabindex="-1">3. Next.js Server-Side Caching <a class="header-anchor" href="#_3-next-js-server-side-caching" aria-label="Permalink to &quot;3. Next.js Server-Side Caching&quot;">â€‹</a></h2><p>We use a preset system in <code>src/lib/graphql-fetch.ts</code> to manage server-side TTL (Time To Live).</p><h3 id="cache-life-presets" tabindex="-1">Cache Life Presets <a class="header-anchor" href="#cache-life-presets" aria-label="Permalink to &quot;Cache Life Presets&quot;">â€‹</a></h3><table tabindex="0"><thead><tr><th style="text-align:left;">Preset</th><th style="text-align:left;">TTL</th><th style="text-align:left;">Typical Content</th></tr></thead><tbody><tr><td style="text-align:left;"><strong><code>seconds</code></strong></td><td style="text-align:left;">10s</td><td style="text-align:left;">Stock levels, limited-time flash sales.</td></tr><tr><td style="text-align:left;"><strong><code>minutes</code></strong></td><td style="text-align:left;">1m</td><td style="text-align:left;">Standard product details, price updates.</td></tr><tr><td style="text-align:left;"><strong><code>hours</code></strong></td><td style="text-align:left;">1h</td><td style="text-align:left;">Navigation menus, category listings.</td></tr><tr><td style="text-align:left;"><strong><code>days</code></strong></td><td style="text-align:left;">24h</td><td style="text-align:left;">Homepage banners, footer links.</td></tr><tr><td style="text-align:left;"><strong><code>max</code></strong></td><td style="text-align:left;">1yr</td><td style="text-align:left;">Legal documents, archived pages.</td></tr></tbody></table><h2 id="_4-revalidation-invalidation" tabindex="-1">4. Revalidation &amp; Invalidation <a class="header-anchor" href="#_4-revalidation-invalidation" aria-label="Permalink to &quot;4. Revalidation &amp; Invalidation&quot;">â€‹</a></h2><p>Keep your storefront accurate by clearing the cache when data changes.</p><h3 id="tag-based-invalidation" tabindex="-1">Tag-Based Invalidation <a class="header-anchor" href="#tag-based-invalidation" aria-label="Permalink to &quot;Tag-Based Invalidation&quot;">â€‹</a></h3><p>Use constants from <code>src/utils/constants.ts</code> to group related queries for bulk invalidation.</p><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// src/utils/constants.ts</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> TAGS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  products: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;products&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  cart: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;cart&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  theme: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;themeCustomize&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Revalidating from a Server Action</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { revalidateTag } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;next/cache&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">revalidateTag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">TAGS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.products);</span></span></code></pre></div><h2 id="_5-http-cache-strategy-next-config-ts" tabindex="-1">5. HTTP Cache Strategy (next.config.ts) <a class="header-anchor" href="#_5-http-cache-strategy-next-config-ts" aria-label="Permalink to &quot;5. HTTP Cache Strategy (next.config.ts)&quot;">â€‹</a></h2><p>Control CDN behavior using standard HTTP headers.</p><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Dynamic Routes (Short CDN Cache)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  source</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/product/:path*&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  headers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    key: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Cache-Control&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    value: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;public, s-maxage=3600, stale-while-revalidate=86400&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Private Routes (No Caching)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  source</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/checkout/:path*&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  headers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    key: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Cache-Control&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    value: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;private, no-cache, no-store, must-revalidate&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Static Assets (Long Persistence)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  source</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/_next/static/:path*&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  headers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    key: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Cache-Control&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    value: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;public, max-age=31536000, immutable&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="_6-decision-matrix" tabindex="-1">6. Decision Matrix <a class="header-anchor" href="#_6-decision-matrix" aria-label="Permalink to &quot;6. Decision Matrix&quot;">â€‹</a></h2><table tabindex="0"><thead><tr><th style="text-align:left;">Question</th><th style="text-align:left;">Recommended Strategy</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>Is it user-specific?</strong></td><td style="text-align:left;"><code>no-cache</code> / <code>private</code> headers.</td></tr><tr><td style="text-align:left;"><strong>Is it critical for SEO?</strong></td><td style="text-align:left;">Server-side <code>hours</code> preset.</td></tr><tr><td style="text-align:left;"><strong>Does price/stock change often?</strong></td><td style="text-align:left;"><code>minutes</code> preset + <code>cache-and-network</code>.</td></tr><tr><td style="text-align:left;"><strong>Is it a static legal page?</strong></td><td style="text-align:left;"><code>max</code> preset + <code>immutable</code> headers.</td></tr></tbody></table><p>ðŸ“– <strong>Continue Reading:</strong></p><ul><li><a href="/bagisto-headless-ecommerce/apollo-client/apollo-setup">Apollo Client Setup</a></li><li><a href="/bagisto-headless-ecommerce/apollo-client/request-utility">GraphQL Request Utility</a></li><li><a href="/bagisto-headless-ecommerce/getting-started/environment-variables">Environment Variables</a></li></ul>`,23))])}const C=n(k,[["render",g]]);export{b as __pageData,C as default};
