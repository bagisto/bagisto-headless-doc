import{j as i,c as e,b as a,ah as t}from"./chunks/framework.Br27zpCu.js";const c=JSON.parse('{"title":"Registered Customer Checkout","description":"","frontmatter":{},"headers":[],"relativePath":"bagisto-headless-ecommerce/features/checkout/checkout-flow/registered-customer-checkout.md","filePath":"bagisto-headless-ecommerce/features/checkout/checkout-flow/registered-customer-checkout.md","lastUpdated":1768311680000}'),n={name:"bagisto-headless-ecommerce/features/checkout/checkout-flow/registered-customer-checkout.md"};function h(l,s,r,o,p,d){return a(),e("div",null,[...s[0]||(s[0]=[t(`<h1 id="registered-customer-checkout" tabindex="-1">Registered Customer Checkout <a class="header-anchor" href="#registered-customer-checkout" aria-label="Permalink to &quot;Registered Customer Checkout&quot;">‚Äã</a></h1><p>This guide explains the checkout experience for authenticated (logged-in) customers in the Bagisto Headless storefront.</p><h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to &quot;Overview&quot;">‚Äã</a></h2><p>For registered customers, the checkout process is streamlined by leveraging their existing account data. This includes pre-filling contact information and allowing them to select from their saved address book, resulting in a faster and more personalized experience compared to guest checkout.</p><h2 id="_1-authentication-integration" tabindex="-1">1. Authentication Integration <a class="header-anchor" href="#_1-authentication-integration" aria-label="Permalink to &quot;1. Authentication Integration&quot;">‚Äã</a></h2><p>The checkout process automatically detects the user&#39;s authentication status using <strong>NextAuth.js</strong>.</p><ul><li><strong>Session Detection:</strong> The <code>Stepper</code> component and individual steps check if a customer session is active.</li><li><strong>Email Recognition:</strong> In the initial <strong>Email</strong> step, the customer&#39;s account email is automatically retrieved and pre-filled, often skipping the manual entry requirement.</li></ul><p><strong>File:</strong> <code>src/components/checkout/stepper/Email.tsx</code></p><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> emailFromStorage</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getLocalStorage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">EMAIL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> isGuest</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> !</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">session; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Simplified representation of auth check</span></span></code></pre></div><h2 id="_2-address-management-for-customers" tabindex="-1">2. Address Management for Customers <a class="header-anchor" href="#_2-address-management-for-customers" aria-label="Permalink to &quot;2. Address Management for Customers&quot;">‚Äã</a></h2><p>Unlike guest users who must enter their address manually, registered customers can leverage their saved address book.</p><h3 id="automatic-address-fetching" tabindex="-1">Automatic Address Fetching <a class="header-anchor" href="#automatic-address-fetching" aria-label="Permalink to &quot;Automatic Address Fetching&quot;">‚Äã</a></h3><p>The storefront uses the <code>useAddressesFromApi</code> helper to fetch any addresses already associated with the customer&#39;s active cart or account.</p><p><strong>File:</strong> <code>src/utils/helper.ts</code></p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useAddressesFromApi</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useAddress</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Maps API nodes like &#39;cart_billing&#39; and &#39;cart_shipping&#39; to local state</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    billingAddress: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mapNode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(billingNode),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    shippingAddress: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mapNode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(shippingNode),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  };</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre></div><h3 id="pre-filling-the-form" tabindex="-1">Pre-filling the Form <a class="header-anchor" href="#pre-filling-the-form" aria-label="Permalink to &quot;Pre-filling the Form&quot;">‚Äã</a></h3><p>The <code>GuestAddAdressForm</code> (which also handles registered users) uses these initial values to populate the form fields immediately.</p><p><strong>File:</strong> <code>src/components/checkout/stepper/GuestAddAdressForm.tsx</code></p><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> GuestAddAdressForm</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ({ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">initialBilling</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">initialShipping</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">reset</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useForm</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    defaultValues: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      billing: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        email: initialBilling?.email </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        firstName: initialBilling?.firstName </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // ... other fields</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre></div><h2 id="_3-persistent-cart-merging" tabindex="-1">3. Persistent Cart Merging <a class="header-anchor" href="#_3-persistent-cart-merging" aria-label="Permalink to &quot;3. Persistent Cart Merging&quot;">‚Äã</a></h2><p>If a user was browsing as a guest and then logs in during the checkout process, the storefront automatically merges their guest cart into their customer account. This ensures no items are lost and the checkout progress is maintained.</p><ul><li><strong>Trigger:</strong> Login mutation success.</li><li><strong>Action:</strong> <code>CREATE_MERGE_CART</code> mutation is executed.</li><li><strong>Outcome:</strong> The local Redux store is updated with the consolidated cart data.</li></ul><h2 id="summary" tabindex="-1">Summary <a class="header-anchor" href="#summary" aria-label="Permalink to &quot;Summary&quot;">‚Äã</a></h2><ul><li><strong>Profile Aware:</strong> Utilizes account data to minimize user effort.</li><li><strong>Seamless Merge:</strong> Transitions guest carts into customer accounts without data loss.</li><li><strong>Dynamic Pre-filling:</strong> Uses custom hooks to fetch and map saved addresses to the checkout forms.</li><li><strong>Unified Experience:</strong> Shares the same multi-step logic as guest checkout but with automated data population.</li></ul><h2 id="next-steps" tabindex="-1">Next Steps <a class="header-anchor" href="#next-steps" aria-label="Permalink to &quot;Next Steps&quot;">‚Äã</a></h2><ul><li>üîê <a href="/bagisto-headless-ecommerce/authentication/nextauth-setup">Customer Authentication</a> - Understanding how customer sessions are managed.</li><li>üß± <a href="/bagisto-headless-ecommerce/features/checkout/checkout-flow/multi-step-checkout">Multi-step Checkout</a> - Overview of the universal checkout stages.</li><li>üè† <a href="/bagisto-headless-ecommerce/features/checkout/shipping-billing/address-management">Address Book</a> - Managing saved addresses in the customer profile.</li></ul>`,26)])])}const g=i(n,[["render",h]]);export{c as __pageData,g as default};
