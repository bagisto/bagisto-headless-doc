import{j as i,c as a,b as e,ah as t}from"./chunks/framework.Br27zpCu.js";const c=JSON.parse('{"title":"Error Handling","description":"","frontmatter":{},"headers":[],"relativePath":"bagisto-headless-ecommerce/best-practices/error-handling.md","filePath":"bagisto-headless-ecommerce/best-practices/error-handling.md","lastUpdated":1768206826000}'),n={name:"bagisto-headless-ecommerce/best-practices/error-handling.md"};function r(l,s,h,o,p,d){return e(),a("div",null,[...s[0]||(s[0]=[t(`<h1 id="error-handling" tabindex="-1">Error Handling <a class="header-anchor" href="#error-handling" aria-label="Permalink to &quot;Error Handling&quot;">‚Äã</a></h1><p>This guide outlines the strategies and patterns used to handle different types of errors in the Bagisto Headless storefront, ensuring a resilient and user-friendly experience.</p><h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to &quot;Overview&quot;">‚Äã</a></h2><p>The storefront implements a multi-layered error handling strategy that covers data fetching, network connectivity, and user input validation. Our goal is to prevent application crashes, provide clear feedback to the user, and maintain a robust state.</p><h2 id="_1-graphql-errors" tabindex="-1">1. GraphQL Errors <a class="header-anchor" href="#_1-graphql-errors" aria-label="Permalink to &quot;1. GraphQL Errors&quot;">‚Äã</a></h2><p>Since we interact with the Bagisto backend exclusively through GraphQL, handling API-level errors is critical.</p><h3 id="handling-graphql-context" tabindex="-1">Handling GraphQL Context <a class="header-anchor" href="#handling-graphql-context" aria-label="Permalink to &quot;Handling GraphQL Context&quot;">‚Äã</a></h3><p>GraphQL queries often return a <code>200 OK</code> HTTP status even if the request partially failed. We handle this in our custom fetch utilities by checking the <code>data</code> and <code>errors</code> arrays.</p><p><strong>File:</strong> <code>src/utils/fetch-handler.ts</code></p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">response.ok) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    data: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    error: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      status: response?.status,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      message: result?.error </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Something went wrong&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  };</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="mutation-side-effects" tabindex="-1">Mutation Side-Effects <a class="header-anchor" href="#mutation-side-effects" aria-label="Permalink to &quot;Mutation Side-Effects&quot;">‚Äã</a></h3><p>When using <code>useMutation</code>, we provide <code>onSuccess</code> and <code>onError</code> callbacks to give users immediate feedback via the custom toast system.</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">mutateAsync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useMutation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  onSuccess</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">res?.data?.success) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      showToast</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(res?.message, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;danger&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  onError</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    showToast</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(err.message </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">??</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;An unexpected error occurred&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;danger&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><h2 id="_2-network-application-errors" tabindex="-1">2. Network &amp; Application Errors <a class="header-anchor" href="#_2-network-application-errors" aria-label="Permalink to &quot;2. Network &amp; Application Errors&quot;">‚Äã</a></h2><p>For critical failures that prevent a page from rendering, we use Next.js&#39;s built-in error boundary system.</p><h3 id="error-boundaries" tabindex="-1">Error Boundaries <a class="header-anchor" href="#error-boundaries" aria-label="Permalink to &quot;Error Boundaries&quot;">‚Äã</a></h3><p>We use <code>error.tsx</code> files located in the <code>app/</code> directory segments to catch runtime errors and provide a fallback UI that doesn&#39;t break the entire site.</p><p><strong>File:</strong> <code>src/app/(public)/error.tsx</code></p><ul><li><strong>User-Friendly Message:</strong> &quot;Oh no! There was an issue with our storefront.&quot;</li><li><strong>Recovery Action:</strong> Provides a &quot;Try Again&quot; button that triggers the <code>reset()</code> function to attempt a re-render.</li></ul><h3 id="logging-errors" tabindex="-1">Logging Errors <a class="header-anchor" href="#logging-errors" aria-label="Permalink to &quot;Logging Errors&quot;">‚Äã</a></h3><p>Unexpected errors are logged to the console in development. For production, these can be hooked into monitoring services like Sentry to track recurring issues.</p><h2 id="_3-validation-errors" tabindex="-1">3. Validation Errors <a class="header-anchor" href="#_3-validation-errors" aria-label="Permalink to &quot;3. Validation Errors&quot;">‚Äã</a></h2><p>Validation ensures that the data sent to the backend is correct and matches the expected schema.</p><h3 id="client-side-validation" tabindex="-1">Client-Side Validation <a class="header-anchor" href="#client-side-validation" aria-label="Permalink to &quot;Client-Side Validation&quot;">‚Äã</a></h3><p>We use <strong>React Hook Form</strong> to manage form state and provide real-time validation feedback. This is used extensively in checkout and customer registration.</p><ul><li><strong>Immediate Feedback:</strong> Errors are displayed as soon as a field loses focus or the form is submitted.</li><li><strong>Rules:</strong> We define rules for required fields, email formats, and minimum lengths.</li></ul><h3 id="server-side-validation" tabindex="-1">Server-Side Validation <a class="header-anchor" href="#server-side-validation" aria-label="Permalink to &quot;Server-Side Validation&quot;">‚Äã</a></h3><p>Even with client-side checks, the Bagisto API performs its own validation. If a mutation fails due to business logic (e.g., &quot;Out of stock&quot; or &quot;Invalid address&quot;), the error message is intercepted and displayed to the user via Toasts.</p><h2 id="_4-timeout-retry-logic" tabindex="-1">4. Timeout &amp; Retry Logic <a class="header-anchor" href="#_4-timeout-retry-logic" aria-label="Permalink to &quot;4. Timeout &amp; Retry Logic&quot;">‚Äã</a></h2><p>While not globally enforced, critical operations like cart synchronization and payment capturing can implement retry logic using <code>@tanstack/react-query</code> settings to handle temporary network blips.</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useQuery</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  queryKey: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;cart&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  queryFn: fetchCart,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  retry: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Automatically retry 3 times on failure</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  retryDelay: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><h2 id="best-practices" tabindex="-1">Best Practices <a class="header-anchor" href="#best-practices" aria-label="Permalink to &quot;Best Practices&quot;">‚Äã</a></h2><ul><li><strong>Never Show Raw Errors:</strong> Avoid displaying technical stack traces or raw GraphQL error objects to users. Always map these to readable messages.</li><li><strong>Graceful Fallbacks:</strong> Use Skeletons or Fallback components when data is missing or fetching fails.</li><li><strong>Persistent Notifications:</strong> Use the <code>ToastProvider</code> for non-blocking notifications that let the user know their action failed without taking them away from their current page.</li></ul><h2 id="next-steps" tabindex="-1">Next Steps <a class="header-anchor" href="#next-steps" aria-label="Permalink to &quot;Next Steps&quot;">‚Äã</a></h2><ul><li>üèóÔ∏è <a href="/bagisto-headless-ecommerce/overview/architecture-overview.html">Architecture Overview</a> - The high-level map of our resilient system.</li><li>üíæ <a href="/bagisto-headless-ecommerce/features/cart/state-management/redux-integration.html">State Management</a> - How error states are managed in Redux.</li><li>üß± <a href="/bagisto-headless-ecommerce/overview/architecture-overview/feature-components.html">Feature Components</a> - See error handling in specific UI modules.</li></ul>`,35)])])}const g=i(n,[["render",r]]);export{c as __pageData,g as default};
