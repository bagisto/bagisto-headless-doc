import{j as i,c as a,b as e,ah as t}from"./chunks/framework.Br27zpCu.js";const c=JSON.parse('{"title":"Revalidation Strategies","description":"","frontmatter":{},"headers":[],"relativePath":"bagisto-headless-ecommerce/advanced/caching-strategies/revalidation-strategies.md","filePath":"bagisto-headless-ecommerce/advanced/caching-strategies/revalidation-strategies.md","lastUpdated":1768401425000}'),n={name:"bagisto-headless-ecommerce/advanced/caching-strategies/revalidation-strategies.md"};function l(h,s,r,p,o,d){return e(),a("div",null,[...s[0]||(s[0]=[t(`<h1 id="revalidation-strategies" tabindex="-1">Revalidation Strategies <a class="header-anchor" href="#revalidation-strategies" aria-label="Permalink to &quot;Revalidation Strategies&quot;">‚Äã</a></h1><p>This guide explains the different strategies used in the Bagisto Headless storefront to ensure that cached data in the storefront stays up-to-date with the Bagisto backend.</p><h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to &quot;Overview&quot;">‚Äã</a></h2><p>Caching is essential for performance, but it can lead to stale data. To solve this, we implement several revalidation strategies that strike a balance between high speed and data accuracy.</p><h2 id="_1-time-based-revalidation-ttl" tabindex="-1">1. Time-Based Revalidation (TTL) <a class="header-anchor" href="#_1-time-based-revalidation-ttl" aria-label="Permalink to &quot;1. Time-Based Revalidation (TTL)&quot;">‚Äã</a></h2><p>Time-based revalidation automatically purges cached data after a specific duration has passed. This is handled by the <code>life</code> option in our <code>graphqlRequest</code> utility.</p><p><strong>File:</strong> <code>src/lib/graphql-fetch.ts</code></p><p>The storefront uses predefined &quot;presets&quot; to make revalidation management easier for developers:</p><ul><li><strong><code>seconds</code> (10s):</strong> For very volatile data (e.g., current cart quantities if managed via SSR).</li><li><strong><code>minutes</code> (60s):</strong> For frequently changing content like home page banners.</li><li><strong><code>hours</code> (1 hour):</strong> The default for products and category listings.</li><li><strong><code>days</code> (24h+):</strong> For mostly static structural data like the category tree or store configurations.</li></ul><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getRevalidateTime</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">life</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CacheLifeOption</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">life) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> life </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;number&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> life;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  switch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (life) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    case</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;seconds&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    case</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;minutes&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 60</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    case</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;hours&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3600</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    case</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;days&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 86400</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="_2-on-demand-revalidation-cache-tags" tabindex="-1">2. On-Demand Revalidation (Cache Tags) <a class="header-anchor" href="#_2-on-demand-revalidation-cache-tags" aria-label="Permalink to &quot;2. On-Demand Revalidation (Cache Tags)&quot;">‚Äã</a></h2><p>On-demand revalidation allows us to manually purge specific data the moment it becomes outdated. This is more efficient than time-based revalidation because it only refreshes data when necessary.</p><h3 id="implementation" tabindex="-1">Implementation <a class="header-anchor" href="#implementation" aria-label="Permalink to &quot;Implementation&quot;">‚Äã</a></h3><p>We assign <strong>tags</strong> to every cached GraphQL request. These tags usually correspond to the type of data or a specific record ID.</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> graphqlRequest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">GET_PRODUCT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, { id: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    tags: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;products&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;product-1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><h3 id="targeted-purging" tabindex="-1">Targeted Purging <a class="header-anchor" href="#targeted-purging" aria-label="Permalink to &quot;Targeted Purging&quot;">‚Äã</a></h3><p>When an event occurs (like a product update in Bagisto Admin), the storefront can use Next.js&#39;s <code>revalidateTag</code> function to clear all cache segments associated with that tag.</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { revalidateTag } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;next/cache&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Purge all cached products</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">revalidateTag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;products&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Purge only a specific product</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">revalidateTag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;product-1&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><h2 id="_3-client-side-revalidation" tabindex="-1">3. Client-Side Revalidation <a class="header-anchor" href="#_3-client-side-revalidation" aria-label="Permalink to &quot;3. Client-Side Revalidation&quot;">‚Äã</a></h2><p>For interactive features like the shopping cart, we rely on immediate state updates to provide a responsive experience.</p><ul><li><strong>State Sync:</strong> After a mutation (e.g., <code>addItemToCart</code>), we dispatch a Redux action to update the local cart state immediately using the API response.</li><li><strong>Query Refetching:</strong> We use <code>@tanstack/react-query</code> or <code>@apollo/client</code> refetching logic to trigger a background refresh of stale queries once a mutation completes.</li></ul><h2 id="_4-ssg-isr-revalidation" tabindex="-1">4. SSG &amp; ISR Revalidation <a class="header-anchor" href="#_4-ssg-isr-revalidation" aria-label="Permalink to &quot;4. SSG &amp; ISR Revalidation&quot;">‚Äã</a></h2><p>For statically generated routes (SSG), we use <strong>Incremental Static Regeneration (ISR)</strong>. By specifying a <code>revalidate</code> interval in the page component, Next.js will recreate the page in the background after the timeout.</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> revalidate</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3600</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Revalidate the page every hour</span></span></code></pre></div><h2 id="best-practices" tabindex="-1">Best Practices <a class="header-anchor" href="#best-practices" aria-label="Permalink to &quot;Best Practices&quot;">‚Äã</a></h2><ol><li><strong>Start Conservative:</strong> Use shorter TTLs (<code>minutes</code>) during development and transition to longer ones (<code>hours</code> or <code>days</code>) for production.</li><li><strong>Use Broad &amp; Specific Tags:</strong> Always include a general tag (e.g., <code>products</code>) and a specific one (e.g., <code>product-ID</code>) to allow both global and granular purges.</li><li><strong>Prefer On-Demand:</strong> Whenever possible, use tags to update the cache rather than relying solely on timers.</li></ol><h2 id="next-steps" tabindex="-1">Next Steps <a class="header-anchor" href="#next-steps" aria-label="Permalink to &quot;Next Steps&quot;">‚Äã</a></h2><ul><li>‚ö° <a href="/bagisto-headless-ecommerce/advanced/caching-strategies/nextjs-caching">Next.js Caching</a> - Deep dive into the server-side cache.</li><li>üèóÔ∏è <a href="/bagisto-headless-ecommerce/overview/architecture-overview">Architecture Overview</a> - How revalidation fits into the global system.</li><li>üß± <a href="/bagisto-headless-ecommerce/overview/architecture-overview/feature-components">Feature Components</a> - See how specific components trigger revalidation.</li></ul>`,28)])])}const g=i(n,[["render",l]]);export{c as __pageData,g as default};
