import{j as e,c as i,b as a,ah as t}from"./chunks/framework.Br27zpCu.js";const c=JSON.parse('{"title":"Address Management","description":"","frontmatter":{},"headers":[],"relativePath":"bagisto-headless-ecommerce/features/checkout/shipping-billing/address-management.md","filePath":"bagisto-headless-ecommerce/features/checkout/shipping-billing/address-management.md","lastUpdated":1768233865000}'),n={name:"bagisto-headless-ecommerce/features/checkout/shipping-billing/address-management.md"};function r(h,s,d,l,o,p){return a(),i("div",null,[...s[0]||(s[0]=[t(`<h1 id="address-management" tabindex="-1">Address Management <a class="header-anchor" href="#address-management" aria-label="Permalink to &quot;Address Management&quot;">â€‹</a></h1><p>This guide explains how shipping and billing addresses are managed during the checkout process in the Bagisto Headless storefront.</p><h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to &quot;Overview&quot;">â€‹</a></h2><p>The address management system handles the collection, validation, and persistence of user location data. It supports both guest users (who enter data manually) and registered customers (who can use saved addresses). The system distinguishes between billing and shipping addresses and provides the option to use the same address for both.</p><h2 id="_1-address-types" tabindex="-1">1. Address Types <a class="header-anchor" href="#_1-address-types" aria-label="Permalink to &quot;1. Address Types&quot;">â€‹</a></h2><p>The storefront manages two types of addresses:</p><ul><li><strong>Billing Address:</strong> The address associated with the payment method.</li><li><strong>Shipping Address:</strong> The physical location where the order will be delivered.</li></ul><p>Users can toggle the &quot;Use the same address for shipping?&quot; checkbox to avoid redundant data entry.</p><h2 id="_2-address-persistence" tabindex="-1">2. Address Persistence <a class="header-anchor" href="#_2-address-persistence" aria-label="Permalink to &quot;2. Address Persistence&quot;">â€‹</a></h2><h3 id="server-side" tabindex="-1">Server-Side <a class="header-anchor" href="#server-side" aria-label="Permalink to &quot;Server-Side&quot;">â€‹</a></h3><p>Addresses are saved to the Bagisto backend using the <code>CREATE_CHECKOUT_ADDRESS</code> mutation. This mutation updates the active cart session with the provided details.</p><p><strong>File:</strong> <code>src/graphql/checkout/mutations/CreateCheckoutAddress.ts</code></p><h3 id="client-side-redux" tabindex="-1">Client-Side (Redux) <a class="header-anchor" href="#client-side-redux" aria-label="Permalink to &quot;Client-Side (Redux)&quot;">â€‹</a></h3><p>Once the API responds with a success message, the addresses are also stored in the Redux store to ensure they remain accessible throughout the remainder of the checkout session (e.g., for the Order Review step).</p><p><strong>File:</strong> <code>src/store/slices/cart-slice.ts</code></p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setCheckoutAddresses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state, action) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  state.billingAddress </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> action.payload.billing;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  state.shippingAddress </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> action.payload.shipping;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">},</span></span></code></pre></div><h2 id="_3-registered-customer-features" tabindex="-1">3. Registered Customer Features <a class="header-anchor" href="#_3-registered-customer-features" aria-label="Permalink to &quot;3. Registered Customer Features&quot;">â€‹</a></h2><p>For authenticated users, the system provides an enhanced experience via the <code>useAddress</code> hook and <code>useAddressesFromApi</code> helper.</p><h3 id="fetching-saved-addresses" tabindex="-1">Fetching Saved Addresses <a class="header-anchor" href="#fetching-saved-addresses" aria-label="Permalink to &quot;Fetching Saved Addresses&quot;">â€‹</a></h3><p>The <code>useAddress</code> hook fetches address nodes associated with the current cart token from the API.</p><p><strong>File:</strong> <code>src/utils/useAddress.ts</code></p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useAddress</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> token</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getCartToken</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useQuery</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    queryKey: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;address&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, token],</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    queryFn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetchHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ url: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;checkout/saveAddress&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre></div><h3 id="data-mapping" tabindex="-1">Data Mapping <a class="header-anchor" href="#data-mapping" aria-label="Permalink to &quot;Data Mapping&quot;">â€‹</a></h3><p>The <code>useAddressesFromApi</code> helper filters these nodes based on their type (<code>cart_billing</code> or <code>cart_shipping</code>) and maps them to a format compatible with the checkout forms.</p><p><strong>File:</strong> <code>src/utils/helper.ts</code></p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> billingNode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> address.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">find</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">a</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> a.node?.addressType </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;cart_billing&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)?.node;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> shippingNode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> address.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">find</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">a</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> a.node?.addressType </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;cart_shipping&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)?.node;</span></span></code></pre></div><h2 id="_4-validation-rules" tabindex="-1">4. Validation Rules <a class="header-anchor" href="#_4-validation-rules" aria-label="Permalink to &quot;4. Validation Rules&quot;">â€‹</a></h2><p>Addresses are validated using <strong>React Hook Form</strong> before submission:</p><ul><li><strong>Required Fields:</strong> Name, street address, city, postcode, and phone.</li><li><strong>Postal Code:</strong> Validated per standard formats.</li><li><strong>Phone Number:</strong> Stripped of non-numeric characters and checked for minimum length (e.g., 10 digits).</li></ul><h2 id="summary" tabindex="-1">Summary <a class="header-anchor" href="#summary" aria-label="Permalink to &quot;Summary&quot;">â€‹</a></h2><ul><li><strong>Unified Logic:</strong> The same form handles both guest and registered user inputs.</li><li><strong>Synced State:</strong> Addresses are persisted both in the backend database and the local Redux store.</li><li><strong>User Convenience:</strong> Automatic address fetching for customers and &quot;same as shipping&quot; toggles reduce friction.</li><li><strong>Validation-First:</strong> Multi-step validation ensures orders are only placed with valid delivery data.</li></ul><h2 id="next-steps" tabindex="-1">Next Steps <a class="header-anchor" href="#next-steps" aria-label="Permalink to &quot;Next Steps&quot;">â€‹</a></h2><ul><li>ğŸšš <a href="/bagisto-headless-ecommerce/features/checkout/shipping-billing/shipping-methods">Shipping Methods</a> - How shipping rates are calculated based on these addresses.</li><li>ğŸ§± <a href="/bagisto-headless-ecommerce/features/checkout/checkout-flow/multi-step-checkout">Multi-step Checkout</a> - The overall checkout structure.</li><li>ğŸ” <a href="/bagisto-headless-ecommerce/features/checkout/checkout-flow/guest-checkout">Guest Checkout</a> - Address handling for non-logged-in users.</li></ul>`,33)])])}const g=e(n,[["render",r]]);export{c as __pageData,g as default};
