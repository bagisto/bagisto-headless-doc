import{j as n,E as l,c as h,b as i,ah as a,h as p,w as t,f as r,I as k,ai as d}from"./chunks/framework.Br27zpCu.js";const m=JSON.parse('{"title":"GraphQL Request Utility","description":"","frontmatter":{},"headers":[],"relativePath":"bagisto-headless-ecommerce/apollo-client/request-utility.md","filePath":"bagisto-headless-ecommerce/apollo-client/request-utility.md","lastUpdated":1769093839000}'),o={name:"bagisto-headless-ecommerce/apollo-client/request-utility.md"};function g(c,s,y,E,u,F){const e=l("Mermaid");return i(),h("div",null,[s[1]||(s[1]=a('<h1 id="graphql-request-utility" tabindex="-1">GraphQL Request Utility <a class="header-anchor" href="#graphql-request-utility" aria-label="Permalink to &quot;GraphQL Request Utility&quot;">‚Äã</a></h1><p>The <code>graphqlRequest</code> utility is a high-performance, server-side data fetching solution for Next.js Server Components. It bridges <strong>Apollo Client</strong> with <strong>Next.js Caching APIs</strong> (<code>unstable_cache</code>) to provide a seamless e-commerce experience.</p><h2 id="_1-why-use-this-utility" tabindex="-1">1. Why Use This Utility? <a class="header-anchor" href="#_1-why-use-this-utility" aria-label="Permalink to &quot;1. Why Use This Utility?&quot;">‚Äã</a></h2><p>Unlike traditional client-side hooks, this utility runs on the server, ensuring your storefront is fast, SEO-friendly, and secure.</p><table tabindex="0"><thead><tr><th style="text-align:left;">Feature</th><th style="text-align:left;"><code>graphqlRequest</code> (Server)</th><th style="text-align:left;"><code>useQuery</code> (Client)</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>SEO</strong></td><td style="text-align:left;">‚úÖ Excellent (Pre-rendered)</td><td style="text-align:left;">‚ùå Limited (Client-rendered)</td></tr><tr><td style="text-align:left;"><strong>Performance</strong></td><td style="text-align:left;">‚úÖ Fast (Server-to-Server)</td><td style="text-align:left;">‚ö†Ô∏è Varied (Client-to-Server)</td></tr><tr><td style="text-align:left;"><strong>Caching</strong></td><td style="text-align:left;">Next.js Data Cache</td><td style="text-align:left;">Apollo InMemory Cache</td></tr><tr><td style="text-align:left;"><strong>Auth Headers</strong></td><td style="text-align:left;">Injected on Server</td><td style="text-align:left;">Injected via Client Link</td></tr></tbody></table><h2 id="_2-architecture-data-flow" tabindex="-1">2. Architecture &amp; Data Flow <a class="header-anchor" href="#_2-architecture-data-flow" aria-label="Permalink to &quot;2. Architecture &amp; Data Flow&quot;">‚Äã</a></h2>',6)),(i(),p(d,null,{default:t(()=>[k(e,{id:"mermaid-76",class:"mermaid",graph:"graph%20TD%0A%20%20%20%20SC(%5B%22Server%20Component%22%5D)%20--%3E%20Util%5B%22graphqlRequest%20Utility%22%5D%0A%20%20%20%20Util%20--%3E%20Cache%7B%22Next.js%20Data%20Cache%22%7D%0A%20%20%20%20Cache%20--%20Hit%20--%3E%20SC%0A%20%20%20%20Cache%20--%20Miss%20--%3E%20Apollo%5B%22Apollo%20Client%20(Server)%22%5D%0A%20%20%20%20Apollo%20--%3E%20API(%5B%22Bagisto%20GraphQL%20API%22%5D)%0A%20%20%20%20API%20--%3E%20Apollo%0A%20%20%20%20Apollo%20--%3E%20Cache%0A%20%20%20%20Cache%20--%3E%20SC%0A"})]),fallback:t(()=>[...s[0]||(s[0]=[r(" Loading... ",-1)])]),_:1})),s[2]||(s[2]=a(`<h2 id="_3-core-implementation" tabindex="-1">3. Core Implementation <a class="header-anchor" href="#_3-core-implementation" aria-label="Permalink to &quot;3. Core Implementation&quot;">‚Äã</a></h2><p>The utility is defined in <code>src/lib/graphql-fetch.ts</code>. Hover or swipe to see the primary patterns.</p><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Standard Query with Caching</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { graphqlRequest } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;@/lib/graphql-fetch&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { GET_PRODUCTS } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;@/graphql/queries&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ProductGrid</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> graphqlRequest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    GET_PRODUCTS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    { limit: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      life: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;hours&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// TTL Preset</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      tags: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;catalog&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// For manual revalidation</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  );</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">View</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> products</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{data.products} /&gt;;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Non-Cached Query (User Data)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { graphqlRequestNoCache } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;@/lib/graphql-fetch&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { GET_CART } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;@/graphql/queries&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CartTotal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Bypasses Next.js cache entirely</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> graphqlRequestNoCache</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">GET_CART</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">span</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;{data.cart.total}&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">span</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Type-Safe Integration</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ProductData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  products</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }[];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> graphqlRequest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ProductData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">GET_PRODUCTS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data.products[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">].name); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Fully typed</span></span></code></pre></div><h2 id="_4-cache-configuration" tabindex="-1">4. Cache Configuration <a class="header-anchor" href="#_4-cache-configuration" aria-label="Permalink to &quot;4. Cache Configuration&quot;">‚Äã</a></h2><h3 id="ttl-presets-life-option" tabindex="-1">TTL Presets (<code>life</code> option) <a class="header-anchor" href="#ttl-presets-life-option" aria-label="Permalink to &quot;TTL Presets (\`life\` option)&quot;">‚Äã</a></h3><p>We provide standard presets to simplify cache management across different page types.</p><table tabindex="0"><thead><tr><th style="text-align:left;">Preset</th><th style="text-align:left;">TTL</th><th style="text-align:left;">Use Case</th></tr></thead><tbody><tr><td style="text-align:left;"><strong><code>seconds</code></strong></td><td style="text-align:left;">10s</td><td style="text-align:left;">Search results, dynamic stock.</td></tr><tr><td style="text-align:left;"><strong><code>minutes</code></strong></td><td style="text-align:left;">60s</td><td style="text-align:left;">Product pages, pricing.</td></tr><tr><td style="text-align:left;"><strong><code>hours</code></strong></td><td style="text-align:left;">1hr</td><td style="text-align:left;">Category lists, navigation.</td></tr><tr><td style="text-align:left;"><strong><code>days</code></strong></td><td style="text-align:left;">24hr</td><td style="text-align:left;">Homepage banners, footer links.</td></tr><tr><td style="text-align:left;"><strong><code>max</code></strong></td><td style="text-align:left;">1yr</td><td style="text-align:left;">CMS pages, Legal documents.</td></tr></tbody></table><h3 id="tagging-invalidation-tags-option" tabindex="-1">Tagging &amp; Invalidation (<code>tags</code> option) <a class="header-anchor" href="#tagging-invalidation-tags-option" aria-label="Permalink to &quot;Tagging &amp; Invalidation (\`tags\` option)&quot;">‚Äã</a></h3><p>Group queries geographically or by entity to clear them simultaneously.</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Create entry</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> graphqlRequest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">QUERY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, vars, { tags: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;products&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`id-\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">pid</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Invalidate in a Server Action</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { revalidateTag } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;next/cache&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">revalidateTag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;products&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Clears all product queries</span></span></code></pre></div><h2 id="_5-technical-safeguards" tabindex="-1">5. Technical Safeguards <a class="header-anchor" href="#_5-technical-safeguards" aria-label="Permalink to &quot;5. Technical Safeguards&quot;">‚Äã</a></h2><ul><li><strong>Stable Key Generation:</strong> The utility sorting variables alphabetically before hashing to ensure consistent cache keys regardless of object order.</li><li><strong>Context Handling:</strong> Caching is automatically disabled if a custom <code>context</code> is provided (e.g., dynamic headers), preventing sensitive data leaks.</li><li><strong>Memoized Printing:</strong> GraphQL query ASTs are memoized to strings to minimize CPU overhead on the server.</li></ul><h2 id="_6-decision-decision-matrix" tabindex="-1">6. Decision Decision Matrix <a class="header-anchor" href="#_6-decision-decision-matrix" aria-label="Permalink to &quot;6. Decision Decision Matrix&quot;">‚Äã</a></h2><div class="important custom-block github-alert"><p class="custom-block-title">&gt; **When to use \`graphqlRequestNoCache\`?**</p><p>Always use the non-cached variant for:</p><ul><li>Shopping Carts</li><li>Customer Profiles</li><li>Checkout Steps</li><li>Any data dependent on <code>Cookie</code> or <code>Authorization</code> headers.</li></ul></div><p>üìñ <strong>Continue Reading:</strong></p><ul><li><a href="/bagisto-headless-ecommerce/apollo-client/cache-options">Cache Options &amp; Configuration</a></li><li><a href="/bagisto-headless-ecommerce/apollo-client/apollo-setup">Apollo Client Setup</a></li><li><a href="/bagisto-headless-ecommerce/getting-started/quick-start-guide">Quick Start Guide</a></li></ul>`,18))])}const f=n(o,[["render",g]]);export{m as __pageData,f as default};
